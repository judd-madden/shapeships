# Shapeships Design Review & Integration Plan

**Date**: December 8, 2024  
**Status**: Design Finalization Phase  
**Next Phase**: Figma Library Import

---

## üìã Overview

This document captures the comprehensive design review conducted before finalizing the Figma component library for import. It serves as the bridge between game architecture and visual design implementation.

---

## üéØ Game Rules Architecture Review

### 3-Phase Turn System

**BUILD PHASE (Steps 1-6):**
1. **Roll Dice** `[always run]` - Automatic d6 for all players
2. **Dice Manipulation** `[conditional]` - Leviathan, Ark of Knowledge
3. **Line Generation** `[always run]` - Add dice + bonus lines + saved lines
4. **Ships That Build** `[conditional]` - Ships build other ships (triggers phase recalculation)
5. **Drawing** `[always run]` - Players spend lines to build ships (triggers phase recalculation)
6. **Upon Completion** `[conditional]` - Powers that trigger when ship is built

### Key Game Mechanics

**Synchronous Turns:**
- Both players move through phases together
- Players declare "ready" to advance each subphase
- Automatic subphases advance immediately
- Conditional subphases skipped if no ships require them

**Dynamic Phase Calculation:**
- Phase requirements recalculated when ships are built during Subphase 4 or 5
- Newly built ships can add required subphases to current turn
- Console logging for debugging phase recalculation

**Health System:**
- Starting health: 25
- Maximum health: 35
- Damage/healing queued during Battle Phase
- Applied all at once during Health Resolution

**Victory Types:**
- **Decisive Victory** - One player at 0, other above 0
- **Narrow Victory** - Both at 0, one higher than the other
- **Draw** - Both at exactly same health ‚â§ 0

### Resource Systems

**Lines (All Species):**
- Generated each turn: dice roll + saved lines + bonus lines
- Used to build basic ships
- Can be saved for future turns

**Joining Lines (Centaur Only):**
- Special resource for Centaur species
- Can ONLY be used for upgrading ships
- Generated by certain Centaur ships

**Energy (Ancient Only):**
- Generated by Ancient ships
- Used to activate Solar Powers

**Charges (Ship-Specific):**
- Some ships have limited-use charges
- Examples: Interceptor (1 charge), Carrier (6 charges)
- Charges deplete with use

### Ship System

**Ship Properties:**
- Ships are permanent power generators (not units with health)
- No position data - positioning is purely visual (auto-positioning rules TBD)
- Ships provide damage/healing each turn
- Ships generate resources (lines, joining lines, energy)

**Glow Colors:**
- Ship glow colors indicate **ship type/function**, NOT species
- Geometric SVG shapes stored as React components
- Accept className prop for arbitrary pixel sizing: `w-[52px] h-[32px]`

---

## üé® Action Panel Design Review

### Design Philosophy

The action panel area defaults to **species ship overviews** and changes based on which ships the player has and which phase the game is in.

### Confirmed Design States

‚úÖ **Default State** - Species ship overview (educational reference)  
‚úÖ **Automatic Processing** - "Processing Dice + Lines" visual feedback  
‚úÖ **Charge Declaration** - Grid layout with multiple ship action buttons  
‚úÖ **First Strike** - Specific ship actions  
‚úÖ **Victory States** - Decisive Victory, Narrow Loss, Draw  
‚úÖ **Multiple Ships** - Grid supports multiple simultaneous actions  
‚úÖ **Event Messages** - "You Killed a Leviathan" style battle notifications  

### Icon Clarification

**"Draw" Icon** (previously mistaken for "edit"):
- Represents the **Drawing phase** (Subphase 5)
- Dual meaning: "drawing" ships in game terminology + physical paper-based play
- Shows which phase is active/relevant

---

## üñ•Ô∏è Full Game Board Design Analysis

### Layout Structure

**Left Sidebar:**
- **Turn/Phase Navigation** - "Turn 1 - MAJOR PHASE" with draw icon
- **Battle Log** - Collapsible, auto-scrolling game events
- **Chat** - Player communication separate from battle log

**Center Area:**
- **Action Panel** - Dynamic based on current subphase
- **Ready Button** - Bottom-center with conditional note
- **Undo Actions Button** - Left of Ready button
- **Next Phase Preview** - Bottom-right indicator

**Top Center:**
- **Phase Header** - Subphase information and description
- **Chess Clock Timers** - 10:04 format, shows active/paused states
- **Dice Display** - Current turn's d6 roll result (top-left)

**Right Sidebar:**
- **Player Stats Dashboard** - Exceeds Guidelines requirements:
  - Current Health: 25
  - Queued Damage: **-3** (red)
  - Queued Healing: **+2** (green)
  - Saved Lines: 99/99
  - Damage Output: 999
  - Healing Output: 999
  - Bonus Lines/Joining Lines: 99/99

**Bottom Right:**
- **Species Buttons** - Quick access to ship selection/overview
- **Spectator Count** - "1 spectator" display
- **Menu Button** - Settings/surrender/rules

### Design Excellence Observations

#### 1. Effect Queue Visualization ‚≠ê **BRILLIANT**
The **-3/+2** health preview numbers are the killer feature:
- Makes abstract "effect queue" concept tangible
- Players see queued effects BEFORE Health Resolution
- Updates in real-time as actions are taken
- Critical for strategic decision-making

**Implementation:**
```typescript
const queuedDamage = gameState.gameData.turnData.accumulatedDamage[playerId] || 0;
const queuedHealing = gameState.gameData.turnData.accumulatedHealing[playerId] || 0;
// Display: 25 -3 +2
```

#### 2. Multiplayer State Visibility
- **Player 2 Ready** - Green dot + "Ready" label + 09:45 timer
- **Player 1 Active** - Green dot + "Species" label + 10:04 timer
- Clear visual distinction between waiting and acting players

#### 3. Information Hierarchy
- **Critical** (always visible): Health, timers, ready status, current phase
- **Contextual** (dynamic): Action panel, queued effects
- **Historical** (collapsible): Battle log, chat

#### 4. Spatial Layout Logic
- **Left**: History (past events)
- **Center**: Current actions (present decisions)
- **Right**: Player stats and future info (next phase)

Natural eye flow: past ‚Üí present ‚Üí future

### Questions Answered by Full Board Design

‚úÖ **"Declare Ready" button?** ‚Üí Bottom-center with conditional note  
‚úÖ **Chess-clock timers?** ‚Üí Top-center, MM:SS format, active/paused states  
‚úÖ **Player stats dashboard?** ‚Üí Right sidebar with comprehensive stats  
‚úÖ **Battle log vs chat?** ‚Üí Separate sections in left sidebar  
‚úÖ **Opponent readiness?** ‚Üí Player 2 area shows "Ready" status clearly  
‚úÖ **Spectator count?** ‚Üí Bottom-right "1 spectator" display  
‚úÖ **Effect queue preview?** ‚Üí Red/green numbers next to health  

---

## üîß Test Interface Clarifications

### Game Test Interface ‚úÖ **PRIMARY REFERENCE**

**Location**: `/game/test/GameTestInterface.tsx`

**Comprehensive Multiplayer Features:**
- ‚úÖ Spectator functionality (player/spectator role selection)
- ‚úÖ Full multiplayer game creation (`/create-game` endpoint)
- ‚úÖ Game joining via URL (`?game=GAMEID&view=game-test`)
- ‚úÖ Real-time polling (via `useGameState` hook, 5-second interval)
- ‚úÖ Automatic game full detection (auto-switches to spectator when 2 players)
- ‚úÖ Server-side role validation (roles enforced on backend)
- ‚úÖ Chat system (message sending/receiving)
- ‚úÖ Battle log (auto-scrolling game log)
- ‚úÖ Ready state synchronization (both players must ready up)
- ‚úÖ Automatic phase progression (server-driven)
- ‚úÖ Ship building actions (select species, build ships)
- ‚úÖ URL sharing (copy game link for multiplayer)

**Why It's the Reference:**
- Uses all real server endpoints
- Full player/spectator system working
- Actual polling architecture implemented
- Complete game lifecycle: Setup ‚Üí Species Selection ‚Üí Ship Building ‚Üí Battle ‚Üí Health Resolution
- Shows opponent status, ready states, player counts

### Multiplayer Test ‚ö†Ô∏è **Connection Test Only**

**Purpose**: Verifies server endpoints respond
- Tests `/health` and `/test-connection` endpoints
- **NOT** a reference for multiplayer features
- Doesn't test game mechanics

### Full Phase Test ‚ö†Ô∏è **Surface-Level Phase Testing**

**Location**: `/game/test/FullPhaseTest.tsx`

**Purpose**: Tests ActionResolver UI integration
- Tests Charge Declaration phase specifically
- Tests effect queueing
- Shows ActionPanel component rendering
- **NOT multiplayer** - just local state
- **NOT comprehensive** - focuses on one phase only

---

## üéÆ Spectator System (Fully Implemented)

### Frontend Implementation

```typescript
// Role selection on create
const createNewGame = async (role: 'player' | 'spectator')

// Role selection on join
const joinExistingGame = async (gameId: string, role: 'player' | 'spectator')

// Auto-select spectator if game full
if (activePlayers.length >= 2) {
  setSelectedRole('spectator');
}

// Display spectator list separately
const spectators = gameState?.players?.filter(p => p.role === 'spectator')
```

### Backend Implementation

```typescript
// Filter active players (exclude spectators from ready checks)
const activePlayers = gameData.players.filter(p => p.role === 'player');

// Only count active players for phase advancement
return activePlayers.every(player => {
  const readiness = phaseReadiness.find(r => r.playerId === player.id);
  return readiness?.isReady && readiness?.currentSubPhase === currentSubPhase;
});
```

### Spectator Capabilities

‚úÖ **Can do:**
- Watch all game state (same polling as players)
- Send chat messages
- See battle log
- See all player stats and actions

‚ùå **Cannot do:**
- Build ships (UI hidden when `isSpectator === true`)
- Declare ready (doesn't affect phase advancement)
- Take any game actions
- Count toward "2 players needed" requirement

### Auto-Conversion

Games automatically convert 3rd+ players to spectators:
- Check player count on join
- If `activePlayers.length >= 2`, force role to spectator
- Show toast notification: "Game is full - you were automatically set as a spectator"

---

## üöÄ Figma Import Strategy

### Import Architecture

**Expected File Structure After Import:**

```
/imports/
  ‚îú‚îÄ‚îÄ action-panel-species-overview.tsx       # Default state
  ‚îú‚îÄ‚îÄ action-panel-charge-declaration.tsx     # Charge phase
  ‚îú‚îÄ‚îÄ action-panel-dice-processing.tsx        # Automatic phase
  ‚îú‚îÄ‚îÄ action-panel-victory-decisive.tsx       # Victory screen
  ‚îú‚îÄ‚îÄ action-panel-drawing-phase.tsx          # Ship building
  ‚îú‚îÄ‚îÄ player-stats-dashboard.tsx              # Right sidebar
  ‚îú‚îÄ‚îÄ battle-log-section.tsx                  # Left sidebar
  ‚îú‚îÄ‚îÄ chat-section.tsx                        # Left sidebar
  ‚îú‚îÄ‚îÄ phase-header.tsx                        # Top center
  ‚îú‚îÄ‚îÄ ready-button.tsx                        # Bottom center
  ‚îú‚îÄ‚îÄ svg-xxxxx/                              # SVG assets
  ‚îî‚îÄ‚îÄ figma:asset/xxxxx.png                   # Raster images

/graphics/
  ‚îú‚îÄ‚îÄ human/assets.tsx        # All Human ship SVGs
  ‚îú‚îÄ‚îÄ xenite/assets.tsx       # All Xenite ship SVGs
  ‚îú‚îÄ‚îÄ centaur/assets.tsx      # All Centaur ship SVGs
  ‚îú‚îÄ‚îÄ ancient/assets.tsx      # All Ancient ship SVGs
  ‚îî‚îÄ‚îÄ ui/assets.tsx           # UI-specific graphics
```

### Integration Phases

#### Phase 1: Import & Preserve
1. Import all Figma components as-is
2. **Don't modify** structure/styling (per Guidelines)
3. Verify all imports render correctly
4. Check SVGs and images load properly

#### Phase 2: Data Binding
Add dynamic data while preserving design:

```typescript
// Import Figma component
import ActionPanelChargeDeclaration from './imports/action-panel-charge-declaration';

// Wrap with data layer
export function ChargeDeclarationPanel({ gameState, onAction }) {
  const pendingActions = usePendingActions(gameState);
  
  return (
    <ActionPanelChargeDeclaration
      ships={pendingActions}
      onHealClick={(shipId) => onAction(shipId, 'heal')}
      onDamageClick={(shipId) => onAction(shipId, 'damage')}
    />
  );
}
```

#### Phase 3: State Switching
Create router that swaps components based on phase:

```typescript
function ActionPanelRouter({ gameState }) {
  const currentSubPhase = getCurrentSubPhase(gameState);
  const playerState = getPlayerState(gameState, localPlayerId);
  
  switch (currentSubPhase) {
    case SubPhase.CHARGE_DECLARATION:
      if (playerState.pendingActions.length > 0) {
        return <ActionPanelChargeDeclaration {...props} />;
      }
      return <ActionPanelSpeciesOverview {...props} />;
      
    case SubPhase.ROLL_DICE:
      return <ActionPanelDiceProcessing {...props} />;
      
    // ... etc for all 13 subphases
  }
}
```

### Graphics System Post-Import

Per Guidelines:
- Ship graphics are **geometric SVGs** (triangles, squares, pentagons)
- Stored as **React components** in faction `assets.tsx` files
- Accept **className** prop for Tailwind utilities
- Use **arbitrary pixel values**: `className="w-[52px] h-[32px]"`

**Example Ship Component:**
```typescript
export const WedgeShip: React.FC<{ className?: string }> = ({ className }) => (
  <svg 
    width="93" 
    height="51" 
    viewBox="0 0 93 51" 
    fill="none"
    className={className}
  >
    <polygon points="46.5,5 88,46 5,46" fill="black" stroke="#9CFF84" strokeWidth="3" />
  </svg>
);

// Usage
<WedgeShip className="w-[93px] h-[51px]" />
<WedgeShip className="w-[186px] h-[102px]" /> // 2x scale
<WedgeShip className="w-[93px] h-[51px] opacity-50" /> // with transparency
```

---

## üìä Implementation Status

### ‚úÖ Already Working (Game Test Interface)

| Feature | Status | Notes |
|---------|--------|-------|
| Spectator system | ‚úÖ Working | Full role management |
| Multiplayer ready states | ‚úÖ Working | Both players must ready up |
| URL-based game joining | ‚úÖ Working | Share link functionality |
| Polling architecture | ‚úÖ Working | 5-second updates via useGameState |
| Chat messaging | ‚úÖ Working | Send/receive messages |
| Auto-phase advancement | ‚úÖ Working | Server-driven when both ready |
| Player/spectator separation | ‚úÖ Working | UI hides controls for spectators |
| Game creation | ‚úÖ Working | Create/join endpoints functional |

### ‚ö†Ô∏è Needs Enhancement

| Feature | Status | Notes |
|---------|--------|-------|
| Battle log formatting | ‚ö†Ô∏è Partial | Actions exist, need readable text formatting |
| Chess-clock timers | ‚ö†Ô∏è Design ready | UI designed, backend logic needed |
| Phase-specific action panels | ‚ö†Ô∏è Simplified | Currently 4 phases, needs all 13 subphase states |
| Effect queue visualization | ‚ö†Ô∏è Backend ready | -3/+2 health preview from design, needs UI |
| Undo actions | ‚ö†Ô∏è Design only | Button designed, logic not implemented |

### ‚ùå Not Implemented (Deferred)

| Feature | Status | Priority |
|---------|--------|----------|
| Full 13-subphase system | ‚ùå Not started | High - expand from 4 to 13 |
| ActionResolver in Game Test | ‚ùå Not integrated | High - exists in Full Phase Test only |
| Ship power activation UI | ‚ùå Infrastructure ready | High - needs action panel states |
| Charge declaration UI | ‚ùå Phase exists | High - needs action panel integration |
| First Strike phase | ‚ùå Defined only | Medium - not integrated yet |

---

## üéØ Development Roadmap Post-Figma Import

### Priority 1: Core Action Panel States (Week 1-2)
Implement action panel states for critical subphases:
1. **Automatic phases** - Dice roll, line generation, automatic battle
2. **Charge Declaration** - Multi-ship grid with charge options
3. **Drawing Phase** - Frigate mandatory selection, Evolver optional, ship building
4. **Ships That Build** - Carrier, Bug Breeder building interfaces
5. **Species overview default** - Educational reference state

### Priority 2: Effect Queue Preview (Week 2)
Implement the **-3/+2** health numbers:
```typescript
// Calculate queued effects for display
const queuedDamage = gameState.gameData.turnData.accumulatedDamage[playerId] || 0;
const queuedHealing = gameState.gameData.turnData.accumulatedHealing[playerId] || 0;

// Display next to current health in real-time
<HealthDisplay 
  current={25} 
  queuedDamage={-3} 
  queuedHealing={+2} 
/>
```

### Priority 3: Battle Log Formatting (Week 2-3)
Transform action history into readable battle log:
- "Turn 5 - BUILD PHASE"
- "Dice is a 4"
- "Player 1 has 12 lines available"
- "Amphibeus builds: Tactical Cruiser"
- "Health Resolution: Player 1 takes 3 damage to 25"

### Priority 4: Ready State Management (Week 3)
Implement conditional ready button:
- Enabled when `canDeclareReady: true`
- Disabled with note when mandatory actions pending
- Hidden/changed when already ready
- Shows "Waiting for opponent..." state

### Priority 5: Phase System Expansion (Week 3-4)
Expand from 4 phases to 13 subphases:
- Integrate GamePhases.tsx into Game Test Interface
- Add all conditional subphase logic
- Implement phase skipping when no ships require subphase
- Add dynamic phase recalculation on ship building

### Priority 6: Timer System (Week 4+)
Chess-clock backend logic:
- Placeholder timers (MM:SS format) initially
- Active vs paused states
- Color coding when time running low
- Integration with turn timers

---

## üîç Design-Code Compatibility Checklist

| Design Element | Code Ready? | Integration Path |
|----------------|-------------|------------------|
| Species overview default | ‚úÖ | Direct import |
| Automatic phases | ‚úÖ | Direct import + phase detection |
| Charge Declaration | ‚úÖ | Import + ActionResolver integration |
| Victory states (3 types) | ‚úÖ | Direct import + victory detection |
| Multiple ships/actions | ‚úÖ | Grid layout supports |
| Declare Ready button | ‚úÖ | Import + sendAction('set_ready') |
| Waiting for opponent | ‚úÖ | Import + phaseReadiness check |
| Chess-clock timers | ‚ö†Ô∏è | Import UI, need backend logic |
| Effect queue preview | ‚úÖ | Import + accumulatedDamage/Healing |
| Battle log | ‚ö†Ô∏è | Import + action formatting |
| Chat system | ‚úÖ | Import + sendAction('message') |
| Player stats dashboard | ‚úÖ | Import + gameState binding |
| Undo actions | ‚ùå | Import UI, defer logic |
| Turn/phase navigation | ‚úÖ | Import + phase state |
| Next phase preview | ‚úÖ | Import + phase calculation |
| Spectator mode | ‚úÖ | Import + role filtering |

---

## üí° Key Design Decisions

### 1. Ship Graphics Philosophy
**Decision**: Ships ARE shapes - "Shapeships" is literal
- Geometric SVG components (triangles, squares, pentagons)
- Glow colors indicate ship type/function, NOT species
- Stored as React components in `/graphics/{species}/assets.tsx`
- No external hosting - bundled with app (zero HTTP requests)

**Rationale**: 
- ~40 KB for all ships (minimal bundle impact)
- Always available (no external dependency)
- Version controlled in Git
- Matches paper-based play design

### 2. Effect Queue Visualization
**Decision**: Show queued damage/healing BEFORE Health Resolution
- Display as **-3** (red) and **+2** (green) next to current health
- Updates in real-time as actions are taken

**Rationale**:
- Makes abstract "effect queue" concept tangible
- Critical for strategic decision-making
- Prevents confusion about when effects apply
- Industry-standard pattern (Hearthstone, MTG Arena use similar)

### 3. Battle Log vs Chat Separation
**Decision**: Separate interfaces in left sidebar
- **Chat**: Player communication
- **Battle Log**: Game events (damage, healing, ship builds, phase changes)

**Rationale**:
- Chat can be social/off-topic
- Battle log is game history reference
- Different scrolling/filtering needs
- Easier to export battle log for replays

### 4. Spectator Integration
**Decision**: Spectators are first-class citizens
- Same game view as players
- Can chat
- Count displayed prominently
- Auto-convert when game full

**Rationale**:
- Supports community/streaming
- Educational for new players
- Tournament observer functionality
- No extra infrastructure needed (same polling)

### 5. Dual-Purpose Icons (Draw)
**Decision**: Icons serve both digital and paper game
- "Draw" icon for Drawing phase
- Represents digital "building ships" AND paper "drawing ships"

**Rationale**:
- Consistent terminology across mediums
- Supports hybrid digital/paper play
- Thematically appropriate
- Educational clarity

---

## üé® Design System Notes

### Color Language (Established)
- **Green dots**: Active/Ready status
- **Red numbers**: Damage (negative health change)
- **Green numbers**: Healing (positive health change)
- **Green text in chat**: System messages
- **Shapeships palette**: `--shapeships-*` variables for game UI
- **Standard Tailwind**: Development tools only

### Typography (Per Guidelines)
- **Roboto font family** (configured in globals.css)
- **Base font size**: 14px (CSS variables)
- **NO overrides** for font-size, font-weight, line-height unless explicitly requested

### Layout Approach
- **Minimize absolute positioning** - use flexbox/grid
- **Responsive by default** - mobile-first approach
- **Consistent spacing** - Tailwind spacing tokens
- **Breathing room** - Negative space for focus

---

## üìù Questions for Figma Finalization

### 1. Component Variants
- Export as separate files per state? (recommended)
- Or one file with multiple variants?

### 2. Dynamic Text/Numbers
- Placeholder text for replacement (e.g., "999" for numbers)?
- Consistent naming conventions?

### 3. Interactive Elements
- Clear visual separation from static elements?
- Hover states designed?
- Disabled states designed?

### 4. Responsive Breakpoints
- Desktop-first (based on current design)?
- Mobile variants included?
- Tablet considerations?

### 5. Asset Organization
- Ship graphics separate from UI components?
- Icons bundled or individual?
- Naming convention established?

---

## ‚úÖ Design Review Grade: A+

**Strengths:**
- Every element has clear purpose
- Answers all architectural questions
- Effect queue visualization is brilliant
- Clear multiplayer state visibility
- Excellent information hierarchy
- Battle log/chat separation solves event messaging
- Room for future features (Undo, Spectators)
- Aligns with minimalist philosophy

**Minor Gaps (Design Ahead of Code - Good Planning):**
- Undo Actions button (UI ready, code deferred)
- Spectator Mode fully designed (working in code)
- Chess Clock timers (UI ready, backend deferred)

**Conclusion**: Production-ready design that perfectly supports the implemented game architecture. Ready for Figma library import and integration with Game Test Interface.

---

## üîó Related Documentation

- **Guidelines**: `/guidelines/Guidelines.md` - Development standards and architecture rules
- **Action Resolution**: `/game/engine/ACTION_RESOLUTION_README.md` - Detailed action system docs
- **Game Test**: `/game/test/GameTestReadme.md` - Test interface documentation
- **Species Data**: `/game/data/SpeciesData.tsx` - Ship and power definitions

---

**Last Updated**: December 8, 2024  
**Next Review**: After Figma library import  
**Status**: Ready for implementation üöÄ